language: c
cache: ccache
git:
  submodules: false
  quiet: true

dist: focal

osx_image: xcode9.3

os:
  - linux
  - osx

compiler:
  - gcc
  - clang

arch:
  - amd64

script:
  - cmake -Bbuild --build .
  - cd build && make pkcs11-daemon pkcs11-proxy

deploy:
  - provider: releases
    skip_cleanup: true
    api_key: $GITHUB_TOKEN
    file_glob: true
    file: build/*.deb
    prerelease: true
    on:
      tags: true
      condition: $TRAVIS_TAG =~ ^v2\.[0-9]+\.[0-9]+-(alpha|beta)\.[0-9]+$
